<?php require_once 'includes/auth.php'; require_login(); require_once 'includes/db.php'; include 'includes/header.php';
$payments = $pdo->query('SELECT p.*, t.full_name, u.unit_number FROM payments p JOIN tenants t ON p.tenant_id = t.id JOIN units u ON p.unit_id = u.id ORDER BY p.payment_date DESC')->fetchAll();
?>
<div class="d-flex"><aside class="sidebar"><h3>APARTMENT</h3></aside><main class="main"><h2>Payment History</h2><div class="table-responsive"><table class="table"><thead><tr><th>ID</th><th>Tenant</th><th>Unit</th><th>Amount</th><th>Method</th><th>Reference</th><th>Date</th><th>Status</th></tr></thead><tbody><?php foreach($payments as $p): ?><tr><td><?= $p['id'] ?></td><td><?= htmlspecialchars($p['full_name']) ?></td><td><?= htmlspecialchars($p['unit_number']) ?></td><td>â‚±<?= number_format($p['amount'],2) ?></td><td><?= htmlspecialchars($p['method']) ?></td><td><?= htmlspecialchars($p['reference_no']) ?></td><td><?= htmlspecialchars($p['payment_date']) ?></td><td><?php if($p['status']=='Paid') echo '<span class="badge-paid">Paid</span>'; else echo '<span class="badge-pending">'.htmlspecialchars($p['status']).'</span>'; ?></td></tr><?php endforeach; ?></tbody></table></div><button class="btn btn-secondary" onclick="window.print()">Print</button></main></div><?php include 'includes/footer.php'; ?>