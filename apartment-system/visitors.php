<?php require_once 'includes/auth.php'; require_login(); require_once 'includes/db.php'; include 'includes/header.php';
$visitors = $pdo->query('SELECT v.*, t.full_name, u.unit_number FROM visitors v LEFT JOIN tenants t ON v.tenant_id=t.id LEFT JOIN units u ON v.unit_id=u.id ORDER BY v.visit_date DESC')->fetchAll();
?>
<div class="d-flex"><aside class="sidebar"><h3>APARTMENT</h3></aside><main class="main"><h2>Visitor Log</h2><div class="table-responsive"><table class="table"><thead><tr><th>ID</th><th>Visitor</th><th>Tenant</th><th>Unit</th><th>Date</th><th>In</th><th>Out</th></tr></thead><tbody><?php foreach($visitors as $v): ?><tr><td><?= $v['id'] ?></td><td><?= htmlspecialchars($v['visitor_name']?:$v['visitor_name']) ?></td><td><?= htmlspecialchars($v['full_name']) ?></td><td><?= htmlspecialchars($v['unit_number']) ?></td><td><?= $v['visit_date'] ?></td><td><?= $v['check_in'] ?></td><td><?= $v['check_out']?:'-' ?></td></tr><?php endforeach; ?></tbody></table></div></main></div><?php include 'includes/footer.php'; ?>