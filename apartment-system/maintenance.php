<?php require_once 'includes/auth.php'; require_login(); require_once 'includes/db.php'; include 'includes/header.php';
if($_SERVER['REQUEST_METHOD']==='POST' && isset($_POST['add_request'])){ $tenant_id=$_POST['tenant_id']; $unit_id=$_POST['unit_id']; $text=$_POST['request_text']; $pdo->prepare('INSERT INTO maintenance (tenant_id,unit_id,request_text) VALUES (?,?,?)')->execute([$tenant_id,$unit_id,$text]); }
$requests = $pdo->query('SELECT m.*, t.full_name, u.unit_number FROM maintenance m JOIN tenants t ON m.tenant_id=t.id JOIN units u ON m.unit_id=u.id ORDER BY m.created_at DESC')->fetchAll();
?>
<div class="d-flex"><aside class="sidebar"><h3>APARTMENT</h3></aside><main class="main"><h2>Maintenance Requests</h2><div class="table-responsive"><table class="table"><thead><tr><th>ID</th><th>Tenant</th><th>Unit</th><th>Issue</th><th>Status</th><th>Created</th></tr></thead><tbody><?php foreach($requests as $r): ?><tr><td><?= $r['id'] ?></td><td><?= htmlspecialchars($r['full_name']) ?></td><td><?= htmlspecialchars($r['unit_number']) ?></td><td><?= htmlspecialchars($r['request_text']) ?></td><td><?= $r['status'] ?></td><td><?= $r['created_at'] ?></td></tr><?php endforeach; ?></tbody></table></div></main></div><?php include 'includes/footer.php'; ?>